# Proposal: Add Image Crop Uploader

## Problem

現在の `ImageUploader` コンポーネントは画像ファイルを選択してそのままアップロードする機能しかありません。しかし、LINEメッセージングアプリでリッチメッセージやカード型メッセージを作成する際、画像を適切なサイズや比率に調整する必要があります。

ユーザーが画像をアップロードする前に：
- 画像を拡大・縮小して調整したい
- 必要な部分だけを切り取りたい
- プレビューしながら調整したい

このニーズに対応するため、画像のクロップ（切り取り）とズーム機能を持つ新しいコンポーネントが必要です。

## Solution

`ImageCropUploader` という新しいコンポーネントを作成します。このコンポーネントは：

1. **画像選択**: ドラッグ&ドロップ、ファイル選択、貼り付けで画像を読み込み
2. **クロップエディタ**: 画像の拡大・縮小・位置調整が可能なインタラクティブなエディタ
3. **アスペクト比固定**: LINEメッセージの要件に合わせたアスペクト比（正方形、16:9など）
4. **プレビュー**: クロップ後の結果をリアルタイムでプレビュー
5. **アップロード**: クロップ後の画像をCloudinaryにアップロード

### 技術スタック

- **react-easy-crop**: シンプルで使いやすいReact用画像クロップライブラリ
  - タッチ対応
  - ズーム・パン操作
  - アスペクト比固定
  - TypeScript対応
- **既存のImageUploader**: 既存のアップロード機能を再利用

### ユーザーフロー

```
1. 画像選択（ドラッグ&ドロップ / ファイル選択 / 貼り付け）
   ↓
2. クロップエディタ表示
   - スライダーでズーム調整
   - ドラッグで位置調整
   - アスペクト比選択（オプション）
   ↓
3. 「切り取る」ボタンクリック
   - Canvas APIで画像をクロップ
   - Blob生成
   ↓
4. Cloudinaryにアップロード
   ↓
5. アップロード完了（URLをコールバックで返却）
```

## Benefits

1. **ユーザビリティ向上**: 画像を適切なサイズに調整してからアップロードできる
2. **デザイン品質向上**: LINEメッセージに最適な画像を作成できる
3. **再利用性**: リッチメッセージ、カード型メッセージ、その他の画像アップロードで共通利用可能
4. **既存コードとの整合性**: 既存の `ImageUploader` のAPIを踏襲

## Non-Goals

- 画像の回転・フィルター機能（将来の拡張として検討可能）
- 複数画像の一括クロップ
- 画像編集の履歴管理（Undo/Redo）

## Component Flexibility

### アスペクト比のProps指定

コンポーネントは以下のPropsでアスペクト比を柔軟に制御できます：

1. **`defaultAspectRatio`**: 初期表示のアスペクト比
   - プリセット: `'FREE' | 'SQUARE' | 'LANDSCAPE' | 'PORTRAIT'`
   - カスタム数値: `16/9`, `4/3` など任意の比率

2. **`aspectRatioOptions`**: UIに表示するアスペクト比の選択肢
   - プリセットとカスタム比率を混在可能
   - 例: `['SQUARE', { label: '4:3', value: 4/3 }]`

3. **`allowAspectRatioChange`**: アスペクト比の変更を許可するか
   - `false` の場合、固定比率（セレクター非表示）

```tsx
// 使用例: 正方形固定
<ImageCropUploader
  onImageUploaded={handleUpload}
  defaultAspectRatio="SQUARE"
  allowAspectRatioChange={false}
/>

// 使用例: カスタム比率を含む選択肢
<ImageCropUploader
  onImageUploaded={handleUpload}
  aspectRatioOptions={[
    'FREE',
    'SQUARE',
    { label: '4:3', value: 4/3 },
  ]}
/>
```

## Open Questions

1. 既存の `ImageUploader` をリプレースするか、別コンポーネントとして共存させるか？
   - 提案: 別コンポーネントとして作成し、必要に応じて段階的に移行
2. 最小/最大クロップサイズの制限は？
   - 提案: 最小1024x1024px（既存の `MIN_DIMENSION` を踏襲）

## Success Criteria

- [ ] 画像をドラッグ&ドロップ/選択/貼り付けでロードできる
- [ ] ズームスライダーで画像を拡大・縮小できる
- [ ] ドラッグで画像の位置を調整できる
- [ ] アスペクト比を選択できる
- [ ] 「切り取る」ボタンでクロップを実行できる
- [ ] クロップ後の画像がCloudinaryにアップロードされる
- [ ] アップロード完了後、URLがコールバックで返却される
- [ ] エラーハンドリングが適切に実装されている
- [ ] レスポンシブデザインで動作する
- [ ] 既存の `ImageUploader` と同様のバリデーション（ファイル形式、サイズ）を実装
