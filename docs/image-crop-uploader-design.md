# ImageCropUploader è¨­è¨ˆæ›¸

## æ¦‚è¦

ImageCropUploader ã¯ã€ç”»åƒã®ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã€ã‚¯ãƒ­ãƒƒãƒ—ã€ã‚ºãƒ¼ãƒ èª¿æ•´ã‚’ä¸€ã¤ã®ãƒ¢ãƒ¼ãƒ€ãƒ« UI ã§å®Œçµã•ã›ã‚‹çµ±åˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã¯ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã€ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠã€è²¼ã‚Šä»˜ã‘ã§ç”»åƒã‚’èª­ã¿è¾¼ã¿ã€ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ã«ã‚¯ãƒ­ãƒƒãƒ—é ˜åŸŸã‚’èª¿æ•´ã§ãã¾ã™ã€‚

### ä¸»ãªæ©Ÿèƒ½

- ç”»åƒã®è¤‡æ•°å…¥åŠ›æ–¹æ³•ï¼ˆãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—ã€ãƒ•ã‚¡ã‚¤ãƒ«ãƒ”ãƒƒã‚«ãƒ¼ã€Cmd/Ctrl+V è²¼ã‚Šä»˜ã‘ï¼‰
- ã‚¤ãƒ³ã‚¿ãƒ©ã‚¯ãƒ†ã‚£ãƒ–ãªã‚¯ãƒ­ãƒƒãƒ—ã‚¨ãƒ‡ã‚£ã‚¿ãƒ¼ï¼ˆãƒ‰ãƒ©ãƒƒã‚°&ã‚ºãƒ¼ãƒ å¯¾å¿œï¼‰
- è¨­å®šå¯èƒ½ãªã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”ãƒ—ãƒªã‚»ãƒƒãƒˆï¼ˆFREE, SQUARE, LANDSCAPE, PORTRAITï¼‰
- æŸ”è»Ÿãªã‚ºãƒ¼ãƒ åˆ¶å¾¡ï¼ˆ80%ã€œ200%ã€ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå¯èƒ½ï¼‰
- ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰ã§ã® Canvas API ã‚¯ãƒ­ãƒƒãƒ”ãƒ³ã‚°
- ã‚¯ãƒ­ãƒƒãƒ—æ¸ˆã¿ç”»åƒã® Blob ç”Ÿæˆï¼ˆå¤–éƒ¨ API ã¨ã®çµ±åˆãŒå®¹æ˜“ï¼‰
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ã€ã‚µã‚¤ã‚ºã€æœ€å°å¯¸æ³•ï¼‰

## æŠ€è¡“é¸å®š

### react-easy-crop

ç”»åƒã‚¯ãƒ­ãƒƒãƒ—æ©Ÿèƒ½ã®å®Ÿè£…ã« `react-easy-crop` ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

**é¸å®šç†ç”±**ï¼š

- ã‚¿ãƒƒãƒ&ãƒã‚¦ã‚¹å¯¾å¿œï¼ˆãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ã¨ãƒ¢ãƒã‚¤ãƒ«ã®ä¸¡æ–¹ï¼‰
- è»½é‡ï¼ˆç´„ 10KB gzippedï¼‰
- React å°‚ç”¨è¨­è¨ˆã§ useState ã¨ã®çµ±åˆãŒå®¹æ˜“
- ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”ã€ã‚ºãƒ¼ãƒ ç¯„å›²ã®ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºãŒå¯èƒ½
- ãƒ”ã‚¯ã‚»ãƒ«åº§æ¨™ã¨ãƒ‘ãƒ¼ã‚»ãƒ³ãƒ†ãƒ¼ã‚¸åº§æ¨™ã®ä¸¡æ–¹ã‚’æä¾›

### Canvas API

ã‚¯ãƒ­ãƒƒãƒ—å¾Œã®ç”»åƒç”Ÿæˆã«ã¯ã€ãƒ–ãƒ©ã‚¦ã‚¶æ¨™æº–ã® Canvas API ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

**é¸å®šç†ç”±**ï¼š

- ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚µã‚¤ãƒ‰å‡¦ç†ï¼ˆã‚µãƒ¼ãƒãƒ¼è² è·ãªã—ï¼‰
- è¿½åŠ ãƒ©ã‚¤ãƒ–ãƒ©ãƒªä¸è¦
- JPEG/PNG å½¢å¼ã®é«˜å“è³ªãªå‡ºåŠ›

## ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆæ§‹æˆ

### ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆå›³

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ImageCropUploader                      â”‚
â”‚  (çµ±åˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ»çŠ¶æ…‹ç®¡ç†ãƒ»UIåˆ¶å¾¡)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                          â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  react-easy-  â”‚        â”‚  crop-utils.ts â”‚
    â”‚     crop      â”‚        â”‚ (Canvaså‡¦ç†)    â”‚
    â”‚ (ã‚¯ãƒ­ãƒƒãƒ—UI)   â”‚        â”‚ (Blobç”Ÿæˆ)     â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

```
src/
â”œâ”€â”€ app/dashboard/_components/
â”‚   â”œâ”€â”€ image-crop-uploader.tsx         # ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â””â”€â”€ image-crop-uploader-example.tsx # ä½¿ç”¨ä¾‹ãƒ»ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
â”‚
â””â”€â”€ lib/
    â””â”€â”€ crop-utils.ts                   # Canvas APIãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
```

## Props ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹

```typescript
export interface ImageCropUploaderProps {
  /** ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å®Œäº†æ™‚ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼ˆç”»åƒURLã‚’è¿”ã™ï¼‰ */
  onImageUploaded: (url: string) => void;

  /** ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯” (default: 'FREE') */
  defaultAspectRatio?: AspectRatioPreset | number;

  /** ã‚¯ãƒ­ãƒƒãƒ—å¾Œã®æœ€å°å¯¸æ³• (default: 240x240) */
  minCroppedWidth?: number;
  minCroppedHeight?: number;

  /** æœ€å°ã‚ºãƒ¼ãƒ å€ç‡ (default: 0.8 = 80%) */
  minZoom?: number;

  /** æœ€å¤§ã‚ºãƒ¼ãƒ å€ç‡ (default: 2 = 200%) */
  maxZoom?: number;

  /** åˆæœŸã‚ºãƒ¼ãƒ å€ç‡ (default: 1 = 100%) */
  defaultZoom?: number;

  /** ã‚ºãƒ¼ãƒ ã‚¹ãƒ†ãƒƒãƒ— (default: 0.01 = 1%åˆ»ã¿) */
  zoomStep?: number;

  /** ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ãƒ†ã‚­ã‚¹ãƒˆ */
  placeholder?: string;
}

// ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”ãƒ—ãƒªã‚»ãƒƒãƒˆ
type AspectRatioPreset = "FREE" | "SQUARE" | "LANDSCAPE" | "PORTRAIT";
```

### ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”ã®å®šç¾©

```typescript
const ASPECT_RATIOS: Record<AspectRatioPreset, number> = {
  FREE: 0, // è‡ªç”±ï¼ˆåˆ¶ç´„ãªã—ï¼‰
  SQUARE: 1, // 1:1
  LANDSCAPE: 16 / 9, // 16:9
  PORTRAIT: 9 / 16, // 9:16
};
```

## react-easy-crop ã®åŸºæœ¬çš„ãªä½¿ã„æ–¹

### ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
npm install react-easy-crop
```

### åŸºæœ¬çš„ãªå®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³

```typescript
import { useState, useCallback } from "react";
import Cropper from "react-easy-crop";
import type { Area, Point } from "react-easy-crop";

function ImageCropUploader() {
  // çŠ¶æ…‹ç®¡ç†
  const [imageSrc, setImageSrc] = useState<string | null>(null);
  const [crop, setCrop] = useState<Point>({ x: 0, y: 0 });
  const [zoom, setZoom] = useState(1);
  const [croppedAreaPixels, setCroppedAreaPixels] = useState<Area | null>(null);

  // ã‚¯ãƒ­ãƒƒãƒ—å®Œäº†æ™‚ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯
  const onCropComplete = useCallback(
    (_croppedArea: Area, croppedAreaPixels: Area) => {
      setCroppedAreaPixels(croppedAreaPixels);
    },
    []
  );

  return (
    <Cropper
      image={imageSrc}
      crop={crop}
      zoom={zoom}
      aspect={1} // 1:1ã®ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”
      onCropChange={setCrop}
      onZoomChange={setZoom}
      onCropComplete={onCropComplete}
      restrictPosition={false} // ä¸­å¿ƒåŸºç‚¹ã®ã‚ºãƒ¼ãƒ 
    />
  );
}
```

### é‡è¦ãª Props

| Prop               | å‹       | èª¬æ˜                                    |
| ------------------ | -------- | --------------------------------------- |
| `image`            | string   | ç”»åƒã® URLï¼ˆData URL ã¾ãŸã¯ HTTP URLï¼‰  |
| `crop`             | Point    | ã‚¯ãƒ­ãƒƒãƒ—ä½ç½® `{ x: number, y: number }` |
| `zoom`             | number   | ã‚ºãƒ¼ãƒ å€ç‡                              |
| `aspect`           | number   | ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”ï¼ˆ0 ã§è‡ªç”±ï¼‰                |
| `restrictPosition` | boolean  | `false`ã§ä¸­å¿ƒåŸºç‚¹ã®ã‚ºãƒ¼ãƒ                |
| `onCropChange`     | function | ã‚¯ãƒ­ãƒƒãƒ—ä½ç½®å¤‰æ›´æ™‚ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯        |
| `onZoomChange`     | function | ã‚ºãƒ¼ãƒ å¤‰æ›´æ™‚ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯              |
| `onCropComplete`   | function | ã‚¯ãƒ­ãƒƒãƒ—å®Œäº†æ™‚ã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯            |

## Canvas API ã«ã‚ˆã‚‹ã‚¯ãƒ­ãƒƒãƒ”ãƒ³ã‚°

### crop-utils.ts ã®å®Ÿè£…

```typescript
export interface Area {
  x: number;
  y: number;
  width: number;
  height: number;
}

/**
 * ç”»åƒURLã‹ã‚‰HTMLImageElementã‚’ä½œæˆ
 */
export function createImage(url: string): Promise<HTMLImageElement> {
  return new Promise((resolve, reject) => {
    const image = new Image();
    image.addEventListener("load", () => resolve(image));
    image.addEventListener("error", (error) =>
      reject(new Error(`ç”»åƒã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: ${error}`))
    );
    image.src = url;
  });
}

/**
 * Canvas APIã‚’ä½¿ç”¨ã—ã¦ç”»åƒã‚’ã‚¯ãƒ­ãƒƒãƒ—ã—ã€Blobã¨ã—ã¦è¿”ã™
 */
export async function getCroppedImg(
  imageSrc: string,
  pixelCrop: Area,
  outputFormat: "image/jpeg" | "image/png" = "image/jpeg"
): Promise<Blob> {
  const image = await createImage(imageSrc);
  const canvas = document.createElement("canvas");
  const ctx = canvas.getContext("2d");

  if (!ctx) {
    throw new Error("Canvas context not available");
  }

  // Canvasã‚µã‚¤ã‚ºã‚’ã‚¯ãƒ­ãƒƒãƒ—å¾Œã®ã‚µã‚¤ã‚ºã«è¨­å®š
  canvas.width = pixelCrop.width;
  canvas.height = pixelCrop.height;

  // å…ƒç”»åƒã‹ã‚‰ã‚¯ãƒ­ãƒƒãƒ—é ˜åŸŸã‚’æç”»
  ctx.drawImage(
    image,
    pixelCrop.x,
    pixelCrop.y,
    pixelCrop.width,
    pixelCrop.height,
    0,
    0,
    pixelCrop.width,
    pixelCrop.height
  );

  // Canvasã‚’Blobã«å¤‰æ›
  return new Promise<Blob>((resolve, reject) => {
    canvas.toBlob(
      (blob) => {
        if (!blob) {
          reject(new Error("Canvas to Blob conversion failed"));
          return;
        }
        resolve(blob);
      },
      outputFormat,
      0.95 // JPEGå“è³ª
    );
  });
}
```

## ä¸»è¦ãªçŠ¶æ…‹ç®¡ç†

```typescript
// ãƒ•ã‚¡ã‚¤ãƒ«é–¢é€£
const [selectedFile, setSelectedFile] = useState<File | null>(null);
const [imageSrc, setImageSrc] = useState<string | null>(null);

// UIçŠ¶æ…‹
const [isCropping, setIsCropping] = useState(false); // ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤º
const [isUploading, setIsUploading] = useState(false); // ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ä¸­

// ã‚¨ãƒ©ãƒ¼ã¨çµæœ
const [error, setError] = useState<UploadError | null>(null);
const [uploadedUrl, setUploadedUrl] = useState<string | null>(null);

// ã‚¯ãƒ­ãƒƒãƒ—é–¢é€£ï¼ˆreact-easy-cropï¼‰
const [crop, setCrop] = useState<Point>({ x: 0, y: 0 });
const [zoom, setZoom] = useState(defaultZoom);
const [croppedAreaPixels, setCroppedAreaPixels] = useState<Area | null>(null);
```

## ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ä»•æ§˜

### ãƒ•ã‚¡ã‚¤ãƒ«ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³

| é …ç›®                   | åˆ¶ç´„                                           |
| ---------------------- | ---------------------------------------------- |
| ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼           | JPEG, PNG ã®ã¿                                 |
| ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚º         | 10MB ä»¥ä¸‹                                      |
| ç”»åƒå¯¸æ³•ï¼ˆã‚¯ãƒ­ãƒƒãƒ—å‰ï¼‰ | 1024x1024px ä»¥ä¸Š                               |
| ã‚¯ãƒ­ãƒƒãƒ—å¾Œå¯¸æ³•         | 240x240px ä»¥ä¸Šï¼ˆProps çµŒç”±ã§ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå¯èƒ½ï¼‰ |

### ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè£…

```typescript
const validateFile = async (file: File): Promise<UploadError | null> => {
  // ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ãƒã‚§ãƒƒã‚¯
  if (!["image/jpeg", "image/png"].includes(file.type)) {
    return {
      message: "JPEG ã¾ãŸã¯ PNG å½¢å¼ã‚’é¸æŠã—ã¦ãã ã•ã„",
      type: "validation",
    };
  }

  // ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãƒã‚§ãƒƒã‚¯
  if (file.size > 10 * 1024 * 1024) {
    return {
      message: "ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã¯10MBä»¥ä¸‹ã«ã—ã¦ãã ã•ã„",
      type: "validation",
    };
  }

  // ç”»åƒå¯¸æ³•ãƒã‚§ãƒƒã‚¯ï¼ˆéåŒæœŸï¼‰
  const img = new Image();
  const objectUrl = URL.createObjectURL(file);

  return new Promise((resolve) => {
    img.onload = () => {
      URL.revokeObjectURL(objectUrl);
      if (img.width < 1024 || img.height < 1024) {
        resolve({
          message: "ç”»åƒã¯1024x1024pxä»¥ä¸ŠãŒå¿…è¦ã§ã™",
          type: "validation",
        });
      } else {
        resolve(null);
      }
    };
    img.src = objectUrl;
  });
};
```

## ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

### 1. ç”»åƒèª­ã¿è¾¼ã¿ãƒ•ãƒ­ãƒ¼

```
ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ/ãƒ‰ãƒ­ãƒƒãƒ—/è²¼ã‚Šä»˜ã‘
    â†“
ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆå½¢å¼ãƒ»ã‚µã‚¤ã‚ºãƒ»å¯¸æ³•ï¼‰
    â†“
FileReader.readAsDataURL
    â†“
setImageSrcï¼ˆData URLè¨­å®šï¼‰
    â†“
setIsCropping(true)ï¼ˆãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤ºï¼‰
    â†“
Cropperã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§èª¿æ•´
    â†“
onCropComplete â†’ croppedAreaPixelsä¿å­˜
```

### 2. ã‚¯ãƒ­ãƒƒãƒ—&ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ•ãƒ­ãƒ¼

```
ã€Œã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã€ãƒœã‚¿ãƒ³ã‚¯ãƒªãƒƒã‚¯
    â†“
æœ€å°å¯¸æ³•ãƒã‚§ãƒƒã‚¯
    â†“
getCroppedImgï¼ˆCanvas APIã§ã‚¯ãƒ­ãƒƒãƒ—ï¼‰
    â†“
Blobç”Ÿæˆ
    â†“
FormDataã§å¤–éƒ¨APIã¸POST
    â†“
ç”»åƒURLå–å¾—
    â†“
onImageUploadedï¼ˆè¦ªã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¸ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ï¼‰
    â†“
ãƒ¢ãƒ¼ãƒ€ãƒ«ã‚¯ãƒ­ãƒ¼ã‚º
```

## UI æ§‹æˆ

### ãƒ¢ãƒ¼ãƒ€ãƒ«æ§‹é€ 

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç”»åƒã‚’ã‚¯ãƒ­ãƒƒãƒ—           [Ã—]       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                     â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
â”‚     â”‚                   â”‚          â”‚
â”‚     â”‚   Cropper ã‚¨ãƒªã‚¢  â”‚          â”‚
â”‚     â”‚  (å›ºå®šã‚¯ãƒ­ãƒƒãƒ—)   â”‚          â”‚
â”‚     â”‚                   â”‚          â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
â”‚                                     â”‚
â”‚  ã‚ºãƒ¼ãƒ : [â”â”â”â”â—â”â”â”â”] 100%        â”‚
â”‚                                     â”‚
â”‚  âš  ã‚¯ãƒ­ãƒƒãƒ—å¾Œã®ã‚µã‚¤ã‚ºãŒå°ã•ã™ãã¾ã™ â”‚
â”‚                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚           [ã‚­ãƒ£ãƒ³ã‚»ãƒ«] [ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰] â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### å…¥åŠ›ã‚¨ãƒªã‚¢æ§‹é€ 

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“                                 â”‚
â”‚  ç”»åƒãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—    â”‚
â”‚  ã¾ãŸã¯é¸æŠã—ã¦ãã ã•ã„              â”‚
â”‚  (Cmd/Ctrl+V ã§è²¼ã‚Šä»˜ã‘ã‚‚å¯èƒ½)      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## å®Ÿè£…ã®é€²ã‚æ–¹

### Phase 1: åŸºæœ¬æ§‹æˆ

1. `crop-utils.ts` ã‚’ä½œæˆ

   - `createImage` é–¢æ•°
   - `getCroppedImg` é–¢æ•°

2. åŸºæœ¬çš„ãªå‹å®šç¾©
   - `ImageCropUploaderProps`
   - `AspectRatioPreset`
   - `UploadError`

### Phase 2: ãƒ•ã‚¡ã‚¤ãƒ«å…¥åŠ›

1. ãƒ‰ãƒ©ãƒƒã‚°&ãƒ‰ãƒ­ãƒƒãƒ—å®Ÿè£…

   - `onDragEnter`, `onDragLeave`, `onDrop` ãƒãƒ³ãƒ‰ãƒ©
   - è¦–è¦šçš„ãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ï¼ˆèƒŒæ™¯è‰²å¤‰åŒ–ï¼‰

2. ãƒ•ã‚¡ã‚¤ãƒ«ãƒ”ãƒƒã‚«ãƒ¼

   - `<input type="file">` ã®éè¡¨ç¤ºåŒ–
   - ã‚¯ãƒªãƒƒã‚¯ã§ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ

3. è²¼ã‚Šä»˜ã‘å¯¾å¿œ

   - `onPaste` ãƒãƒ³ãƒ‰ãƒ©
   - ã‚¯ãƒªãƒƒãƒ—ãƒœãƒ¼ãƒ‰ã‹ã‚‰ã®ç”»åƒå–å¾—

4. ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
   - ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ãƒ»ã‚µã‚¤ã‚ºãƒã‚§ãƒƒã‚¯
   - ç”»åƒå¯¸æ³•ãƒã‚§ãƒƒã‚¯

### Phase 3: react-easy-crop çµ±åˆ

1. Cropper ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®é…ç½®

   - ãƒ¢ãƒ¼ãƒ€ãƒ« UI æ§‹ç¯‰
   - Cropper è¡¨ç¤ºã‚¨ãƒªã‚¢

2. çŠ¶æ…‹ç®¡ç†

   - `crop`, `zoom`, `croppedAreaPixels`

3. ã‚ºãƒ¼ãƒ ã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼
   - `<input type="range">`
   - ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ãƒ‘ãƒ¼ã‚»ãƒ³ãƒ†ãƒ¼ã‚¸è¡¨ç¤º

### Phase 4: Canvas ã‚¯ãƒ­ãƒƒãƒ”ãƒ³ã‚°

1. `getCroppedImg` ã®å‘¼ã³å‡ºã—
2. Blob â†’ FormData å¤‰æ›
3. å¤–éƒ¨ API ã¸ POST
4. ãƒ¬ã‚¹ãƒãƒ³ã‚¹å‡¦ç†

### Phase 5: UI/UX æ”¹å–„

1. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
2. ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
3. ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£å¯¾å¿œ
4. ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–å¯¾å¿œ

## ä½¿ç”¨ä¾‹

### ã‚«ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒ ã§ã®çµ±åˆ

```typescript
// card-form-product.tsx
export function ProductForm({ card, onChange }: ProductFormProps) {
  const handleImageUploaded = (url: string) => {
    onChange({ imageUrl: url });
  };

  return (
    <ImageCropUploader
      onImageUploaded={handleImageUploaded}
      defaultAspectRatio="SQUARE"
      placeholder="å•†å“ç”»åƒã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ (JPEG/PNG, 1024x1024pxä»¥ä¸Š)"
    />
  );
}
```

### ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯”ã®é¸ã³æ–¹

| ç”¨é€”             | ã‚¢ã‚¹ãƒšã‚¯ãƒˆæ¯” | ç†ç”±                 |
| ---------------- | ------------ | -------------------- |
| å•†å“ç”»åƒ         | SQUARE       | æ­£æ–¹å½¢ãŒä¸€èˆ¬çš„       |
| ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å†™çœŸ | SQUARE       | SNS ã¨çµ±ä¸€           |
| å ´æ‰€ã®å†™çœŸ       | LANDSCAPE    | é¢¨æ™¯ã¯æ¨ªé•·           |
| è‡ªç”±ãªç”¨é€”       | FREE         | ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«é¸æŠã•ã›ã‚‹ |

## å®šæ•°å®šç¾©

```typescript
// ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³åˆ¶ç´„
const ALLOWED_TYPES = ["image/jpeg", "image/png"];
const MAX_FILE_SIZE = 10 * 1024 * 1024; // 10MB
const MIN_DIMENSION = 1024; // ã‚¯ãƒ­ãƒƒãƒ—å‰
const DEFAULT_MIN_CROPPED_DIMENSION = 240; // ã‚¯ãƒ­ãƒƒãƒ—å¾Œ

// ã‚ºãƒ¼ãƒ è¨­å®š
const DEFAULT_MIN_ZOOM = 0.8; // 80%
const DEFAULT_MAX_ZOOM = 2; // 200%
const DEFAULT_ZOOM = 1; // 100%
const DEFAULT_ZOOM_STEP = 0.01; // 1%åˆ»ã¿
```

## å‚è€ƒè³‡æ–™

- [react-easy-crop - GitHub](https://github.com/valentinh/react-easy-crop)
- [MDN - Canvas API](https://developer.mozilla.org/ja/docs/Web/API/Canvas_API)
- [MDN - File API](https://developer.mozilla.org/ja/docs/Web/API/File)
- [MDN - Drag and Drop API](https://developer.mozilla.org/ja/docs/Web/API/HTML_Drag_and_Drop_API)
